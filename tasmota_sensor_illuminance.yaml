# mqtt_devices.yaml
#
# Copyright (C) 2022 Daniele Bochicchio, All Rights Reserved
# For updates see https://github.com/dbochicchio/reactor-mqtt-contrib
#
# *** IMPORTANT ***
# You can import into your own templates by pasting into a "templates" section 
# to a file named local_mqtt_devices.yaml in your config directory.
---
version: 22323
revision: 1
format: 1

templates:
  # tasmota with illuminance
  tasmota_sensor_illuminance:
    type: ValueSensor
    capabilities: [light_sensor]
    primary_attribute: light_sensor.value
    requires: [topic, source]
    lwt: "tele/%topic%/LWT"
    query: "cmnd/%topic%/STATE"
    description: Tasmota device with illuminance sensor
    contributor_name: Daniele Bochicchio
    contributor_url: https://github.com/dbochicchio/reactor-mqtt-contrib
    events:
      "tele/%topic%/SENSOR":
        "light_sensor.value":
          json_payload: true
          if_expr: '! isnull( payload?[ source ?? "Global" ] )'
          expr: 'payload[ source ?? "Global" ]?.Illuminance'
        "light_sensor.units": 'lux'
        "x_mqtt_tasmota_ir.value":
          json_payload: true
          if_expr: '! isnull( payload?[ source ?? "Global" ] )'
          expr: 'payload[ source ?? "Global" ]?.IR'
        "x_mqtt_tasmota_broadband.value":
          json_payload: true
          if_expr: '! isnull( payload?[ source ?? "Global" ] )'
          expr: 'payload[ source ?? "Global" ]?.Broadband'